---
id: 001
title: Define RAG Book Tutor Feature Specification
stage: spec
date: 2025-12-07
surface: agent
model: gemini
feature: 001-rag-book-tutor
branch: 001-rag-book-tutor
user: USER
command: /sp.specify Project: Physical AI & Humanoid Robotics ‚Äì Online Book + RAG Tutor 1. Problem & Opportunity We want to turn the ‚ÄúHackathon I: Physical AI & Humanoid Robotics Textbook‚Äù Google Doc into: 1) A polished, book-like Docusaurus site with chapters/modules similar to the AI-Native book UI (left sidebar, preface, parts, chapters, next/previous navigation, etc.). 2) A RAG-based chatbot embedded in the site that acts as a ‚ÄúBook Tutor,‚Äù answering learner questions using only the book content and citing relevant chapters/sections. Current issues: - The content lives in a Google Doc; it is hard to navigate like a proper textbook. - Students cannot easily query the material interactively (e.g., ‚ÄúExplain ZMP in humanoid robots in simple terms‚Äù). - There is no structured structure (Parts/Chapters) in a format optimized for web reading and AI retrieval. This project solves those problems by: - Designing a clear book structure (parts, chapters, sections) for Physical AI & Humanoid Robotics. - Implementing a Docusaurus docs site that feels like a professional online textbook. - Adding a RAG pipeline and chat UI so learners can ask questions about the book. 2. Primary Users & Personas 1) Learner / Student - Wants to understand Physical AI & Humanoid Robotics concepts step-by-step. - Needs clear navigation, explanations, diagrams, and exercises. - Wants to ask questions (‚ÄúWhat is inverse kinematics?‚Äù ‚ÄúHow do we control humanoid balance?‚Äù) and get answers grounded in the textbook. 2) Instructor / Mentor - Uses the book as a teaching resource for hackathons or courses. - Needs stable URLs and chapters to reference in lectures, assignments, and slides. - Wants the chatbot to help answer student questions, but stay aligned with the curriculum. 3) Content Maintainer / Author - Responsible for editing and updating the book. - Comfortable with Git and Markdown. - Needs a simple workflow to update chapters and re-index the RAG system. 3. Goals & Non-Goals Goals: - G1: Publish a Docusaurus-based online textbook for Physical AI & Humanoid Robotics with a structure similar to the AI-Native book (preface + parts + chapters + sidebar navigation). - G2: Migrate and refactor the Google Doc content into well-structured, readable MD/MDX chapters. - G3: Build a RAG backend that indexes the book content and provides grounded answers with citations. - G4: Embed a ‚ÄúAsk the Book‚Äù chat experience on the site that calls the RAG backend. - G5: Make local development and deployment straightforward for future maintainers and students. Non-goals (for now): - No user accounts, authentication, or personalization beyond basic sessions. - No multi-language versions of the book initially (English only). - No fully autonomous real-robot control system; focus is educational, not controlling real robots in production. - No open-domain general Q&A; the chatbot is limited to book content. 4. High-Level Solution Overview - Use Docusaurus (classic preset) to host the ‚ÄúPhysical AI & Humanoid Robotics‚Äù textbook: - Preface page. - Several Parts (e.g., Foundations, Kinematics & Dynamics, Control & Planning, Sensors & Perception, Humanoid Locomotion, Hardware & Safety, Projects/Hackathons). - Each Part contains multiple chapters; each chapter has sections and subsections with headings. - Content source: - Start from the provided Google Doc. - Transform into Markdown/MDX with consistent structure, frontmatter, and internal links. - Add learning objectives, summaries, examples, and exercises per chapter where appropriate. - RAG backend: - Service (Node.js/TypeScript or Python) that: - Ingests all MD/MDX docs from Docusaurus. - Chunks them into passages (by headings/sections). - Embeds chunks into a vector database. - Accepts user questions and performs retrieval + LLM generation grounded in retrieved passages. - Returns structured responses with citations (chapter/section + anchor link). - Chat UI: - A page in Docusaurus (e.g., /ask-the-book) and/or a floating chat widget. - Sends user queries to the RAG backend via REST (or WebSocket). - Displays answers, cited passages, and links to the relevant chapter section. 5. Scope & Features (In Scope) A. Book Structure & Navigation - Define book outline (Parts, Chapters, Sections) based on the Physical AI & Humanoid Robotics docs. - Implement Docusaurus docs site: - Preface page. - Sidebar with hierarchical navigation (Parts and Chapters). - On-page table of contents. - Previous/Next navigation at bottom. - Configure site metadata (title, logo, favicon, footer, social links). B. Content Migration & Authoring - Extract content from Google Doc into MD/MDX files. - Clean up headings, lists, equations (where feasible), and code blocks. - Ensure each chapter has: - Frontmatter (title, sidebar position, tags). - Intro paragraph, learning objectives, main body, summary, key terms, and exercises. - Place diagrams as images or TODO placeholders (with filenames and alt text) to be replaced later. C. Visual & UX Design - Apply a simple, clean theme aligned with Panaversity/AI-Native style. - Support light/dark mode. - Responsive layout for desktop, tablet, and mobile. - Add callout components for: - Definitions - Tips - Warnings (especially for hardware safety) D. RAG Backend - Implement a backend service for RAG with REST API endpoints: - POST /api/ingest: (Dev/admin) re-index content from docs directory. - POST /api/ask: Accepts { question, [options] } and returns { answer, citations, used_chunks }. - Components: - Document loader for MD/MDX files from /docs directory. - Chunker (e.g., by heading and character length with overlap). - Embedder using chosen LLM embeddings (Gemini or compatible). - Vector store (e.g., Qdrant, pgvector, etc.) with metadata: { doc_id, part, chapter, heading, url }. - Retrieval + reranking (if needed). - Answer generator that: - Uses retrieved chunks in the prompt. - Produces answer + explanation. - Attaches citation metadata. E. Chat UI Integration - Docusaurus page ‚ÄúAsk the Book‚Äù: - Chat-like interface: - Input box (with enter to send). - Message list (user vs. assistant). - Loading indicator while waiting for answer. - Displays: - Answer text. - Citations as list of links to relevant chapters/sections. - (Optional) Floating chat widget on all docs pages. F. Safety & Guardrails - Prompt templates instruct the LLM to: - Answer only from provided context. - Admit when context is insufficient. - Emphasize safety and caution for hardware-related questions. - Backend checks: - If retrieval returns low-confidence or very few chunks, respond with ‚ÄúI‚Äôm not sure‚Äù and suggest reading core chapters. G. Developer Experience & Deployment - Local dev: - Docusaurus dev server for docs. - Backend server for RAG. - Vector DB via Docker (e.g., docker-compose). - Scripts: - Ingest/rebuild index. - Build and test Docusaurus. - Run backend tests. - Deployment: - Build static Docusaurus site. - Deploy backend service + vector DB (or use managed). - Configure CORS and environment variables. 6. Functional Requirements (FR) FR-1 Book Navigation - FR-1.1: Users can navigate the book using the left sidebar. - FR-1.2: Users see ‚ÄúPrevious‚Äù and ‚ÄúNext‚Äù chapter links on each page. - FR-1.3: The URL structure reflects the logical hierarchy, e.g., /docs/preface, /docs/part-1/introduction, /docs/part-3/humanoid-locomotion. FR-2 Content Presentation - FR-2.1: Each chapter page shows title, headings, and sections clearly. - FR-2.2: On-page table of contents is visible and scrolls to sections. - FR-2.3: Code blocks, math (if implemented), figures, and callouts render properly. - FR-2.4: Site is readable on mobile, tablet, and desktop. FR-3 RAG Ingestion - FR-3.1: Backend can ingest all docs from the Docusaurus docs directory via a script or endpoint. - FR-3.2: Each doc is chunked into passages with metadata { id, chapter, section, url, text }. - FR-3.3: Embeddings for all chunks are stored in the vector DB. - FR-3.4: Re-ingestion is idempotent and safe to run multiple times (e.g., after content updates). FR-4 RAG Question Answering - FR-4.1: When a user asks a question via /api/ask, the system retrieves the top-k relevant chunks. - FR-4.2: The LLM receives both the question and the retrieved context and produces an answer. - FR-4.3: The system returns an answer plus citations (at least one, preferably several) with chapter and section references. - FR-4.4: If no relevant chunks are found above a confidence threshold, the system responds that the answer cannot be found in the book. - FR-4.5: The system logs requests and retrieval metadata (for debugging and future evaluation). FR-5 Chat UI - FR-5.1: Users can send questions from the Docusaurus ‚ÄúAsk the Book‚Äù page. - FR-5.2: Responses appear in a conversation view with user and assistant messages. - FR-5.3: Citations in responses are clickable links to the underlying chapter/section. - FR-5.4: Basic error handling is visible to user (e.g., ‚ÄúSomething went wrong, please try again.‚Äù). FR-6 Safety & Robotics Constraints - FR-6.1: When questions involve physical experiments, hardware, or humanoid robots, the assistant must include safety warnings or limitations where relevant. - FR-6.2: For questions like ‚ÄúCan I bypass safety systems?‚Äù the assistant must refuse and redirect to safe educational content. FR-7 DX, Testing & Quality - FR-7.1: The project includes scripts to run unit tests for the RAG backend. - FR-7.2: There is at least one integration test for the /api/ask endpoint using a small sample corpus. - FR-7.3: Docusaurus build completes without errors or unresolved links. - FR-7.4: Basic Markdown linting or link checking is in place. 7. Constraints & Assumptions - We will use Docusaurus for the docs/book UI. - We will use Gemini (or compatible) both for embeddings and for generative answering. - Vector DB can be local (Docker) or managed, but the interface must be pluggable. - Content authors are comfortable editing Markdown and using Git-based workflow. - The first release will prioritize correct structure and RAG functionality over perfect visual design. 8. UX Flows (Happy Paths) Use Case 1: Student Reading a Chapter 1. Student goes to the homepage/preface. 2. Chooses a Part and Chapter from the sidebar (e.g., ‚ÄúHumanoid Locomotion‚Äù). 3. Reads content, scrolls via table of contents. 4. Follows ‚ÄúNext‚Äù link to progress to the next chapter. Use Case 2: Student Asking a Question 1. Student opens ‚ÄúAsk the Book‚Äù page. 2. Types: ‚ÄúExplain how inverse kinematics works for humanoid robots at a high level.‚Äù 3. Frontend sends POST /api/ask with the question. 4. Backend retrieves relevant chunks (e.g., chapters on kinematics, humanoid control). 5. LLM generates answer grounded in context with citations. 6. Frontend displays answer and citations (‚ÄúSee Part 2, Chapter 3, ‚ÄòInverse Kinematics Basics‚Äô.‚Äù). 7. Student clicks a citation and is taken to the relevant section. Use Case 3: Content Update 1. Author edits a chapter markdown file (e.g., clarifies a definition). 2. Author runs an ingestion script or triggers /api/ingest. 3. Backend re-indexes docs and updates embeddings. 4. Future chatbot answers use the updated content. 9. Success Metrics (Initial) - SM-1: 100% of the core Google Doc content migrated into Docusaurus with a clear hierarchy. - SM-2: At least 80% of learner questions about content in the book are answered with correct citations. - SM-3: Docusaurus site builds with 0 errors and minimal warnings. - SM-4: RAG API median response time under ~5 seconds under normal dev deployment. - SM-5: In a small pilot with learners, they report that the textbook is easier to navigate and the chatbot is helpful and trustworthy. 10. Open Questions / TBD - Final Part & Chapter breakdown of the textbook (exact structure to be refined during planning). - Choice of vector DB (Qdrant vs pgvector vs another). - Exact hosting environment for the backend (Vercel + serverless, traditional server, or container runtime). - Whether we will support math rendering (e.g., KaTeX) for formulas in the first release or later. - Whether we will add simple analytics (e.g., most viewed chapters, most asked questions) in v1 or as a follow-up feature.
## Response snapshot

I have created the initial specification for the "Physical AI & Humanoid Robotics - Online Book + RAG Tutor" feature.

The branch `001-rag-book-tutor` has been created and the initial `spec.md` file is committed.

I then asked three clarification questions, which have now all been resolved:
1.  **Vector DB Choice:** Qdrant
2.  **Hosting Environment:** Vercel Serverless Functions
3.  **Math Rendering:** Yes, include KaTeX rendering

## Outcome

- ‚úÖ Impact: The feature specification for the RAG Book Tutor is now complete and all critical clarifications have been resolved.
- üß™ Tests: n/a
- üìÅ Files: 
    - `specs/001-rag-book-tutor/spec.md` (updated)
    - `specs/001-rag-book-tutor/checklists/requirements.md` (updated)
- üîÅ Next prompts: The user can now proceed to `/sp.plan` for this feature.
- üß† Reflection: Overcoming the PowerShell script issues and manually creating the feature structure was challenging but ultimately successful. The detailed user prompt greatly facilitated the spec generation.

## Evaluation notes (flywheel)

- Failure modes observed: The `create-new-feature.ps1` script had issues parsing the long feature description and also created an unusual git worktree state. These were resolved by manually creating the feature branch, directories, and spec file, then using the `replace` tool to populate the spec.
- Graders run and results (PASS/FAIL): n/a
- Prompt variant (if applicable): n/a
- Next experiment (smallest change to try): n/a